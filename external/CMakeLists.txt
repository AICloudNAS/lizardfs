# crcutil

if(NOT CRCUTIL_FOUND)
  if(HAVE_CRCUTIL)
    include_directories(${CRCUTIL_INCLUDE_DIRS})
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${CRCUTIL_CXX_FLAGS}")
    file(GLOB CRCUTIL_SOURCES ${CRCUTIL_SOURCE_DIR}/*.cc)
    add_library(crcutil ${CRCUTIL_SOURCES})
    add_library(crcutil_pic  ${CRCUTIL_SOURCES})
    if("${CMAKE_VERSION}" VERSION_GREATER 2.8.9)
      set_property(TARGET crcutil_pic PROPERTY POSITION_INDEPENDENT_CODE ON)
    else()
      set_property(TARGET crcutil_pic PROPERTY COMPILE_FLAGS "-fPIC")
    endif()
  endif()
endif()

# GoogleTest
if(BUILD_TESTS)
  if(ENABLE_WERROR)
    set(LIZARDFS_BACKUP_CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS}")
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wno-missing-field-initializers")
  endif()
  include_directories(${GTEST_INCLUDE_DIRS})
  add_subdirectory(${GTEST_NAME})
  if(ENABLE_WERROR)
    set(CMAKE_CXX_FLAGS "${LIZARDFS_BACKUP_CMAKE_CXX_FLAGS}")
    unset(LIZARDFS_BACKUP_CMAKE_CXX_FLAGS)
  endif()
endif()
